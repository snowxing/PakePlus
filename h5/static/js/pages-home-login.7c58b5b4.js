(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-home-login"],{"27c5":function(e,t,n){"use strict";n.r(t);var o=n("a11e"),i=n("850e");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("3205");var s=n("828b"),r=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"5fbca3d9",null,!1,o["a"],void 0);t["default"]=r.exports},3205:function(e,t,n){"use strict";var o=n("481a"),i=n.n(o);i.a},"412f":function(e,t,n){var o=n("c86c");t=o(!1),t.push([e.i,".home-login-container[data-v-5fbca3d9]{position:absolute;left:0;bottom:0;right:0;top:0;padding:0 %?66?%;box-sizing:border-box}.home-login-container .input[data-v-5fbca3d9]{display:flex}.home-login-container .input uni-text[data-v-5fbca3d9]{width:%?40?%;height:%?70?%;display:flex;align-items:center}.home-login-container .input uni-input[data-v-5fbca3d9]{margin-left:%?24?%;padding:0 %?20?%;flex:1;border-bottom:%?1?% solid #ccc;font-size:%?30?%;height:%?70?%;line-height:%?70?%}.home-login-container .button[data-v-5fbca3d9]{text-align:center;width:100%;height:%?80?%;line-height:%?80?%;background:#1c77dc;border-radius:2px;color:#fff;margin-top:%?100?%}.home-login-container .button[data-v-5fbca3d9]:active{opacity:.8}.home-login-container .bg[data-v-5fbca3d9]{width:%?468?%;height:%?356?%;margin:%?110?% auto 0 auto;display:block}.user-a[data-v-5fbca3d9]{color:#1c77dc;text-decoration:none /* 去掉下划线 */}",""]),e.exports=t},"481a":function(e,t,n){var o=n("412f");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var i=n("967d").default;i("488c8340",o,!0,{sourceMap:!1,shadowMode:!1})},"850e":function(e,t,n){"use strict";n.r(t);var o=n("aaea"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},a11e:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"home-login-container",staticStyle:{"text-align":"center"}},[n("v-uni-view",{staticClass:"font42 color-333 font-bold500 mt-20",staticStyle:{"margin-top":"180rpx"}},[e._v(e._s(e.dynamicTitle?e.dynamicTitle:"登录"))]),e.needLogin?n("v-uni-view",{staticStyle:{"text-align":"left","margin-top":"160rpx"}},[n("v-uni-view",{staticClass:"input mt-40"},[n("v-uni-text",{staticClass:"iconfont iconyonghuming- color-999 font40"}),n("v-uni-input",{attrs:{value:e.username,placeholder:"请输入用户名"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.inputUsername.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"input mt-30"},[n("v-uni-text",{staticClass:"iconfont iconxiugaimima- color-999 font40"}),n("v-uni-input",{attrs:{type:"password",value:e.password,placeholder:"请输入密码"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.inputPassword.apply(void 0,arguments)}}})],1),e.isApp?n("v-uni-checkbox-group",{staticStyle:{"margin-top":"80rpx"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.checkChange.apply(void 0,arguments)}}},[n("v-uni-label",[n("v-uni-checkbox",{attrs:{checked:e.isChecked}}),e._v("我已经阅读完并同意"),n("v-uni-text",{staticClass:"user-a",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.gotoAgreement.apply(void 0,arguments)}}},[e._v("《用户隐私协议》")])],1)],1):e._e(),n("v-uni-button",{staticStyle:{"margin-top":"40rpx"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}},[e._v("登录")]),e.isApp?n("v-uni-button",{staticStyle:{"margin-top":"40rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.registerClick.apply(void 0,arguments)}}},[e._v("注册")]):e._e()],1):e._e(),e.loginOK?e._e():[e._v("尝试自动登录")],n("v-uni-image",{staticClass:"bg",attrs:{src:"/static/common/images/login.png"}})],2)},i=[]},aaea:function(e,t,n){"use strict";n("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("64aa"),n("5ef2");var o=n("4241"),i=n("1575"),a=n("6e31"),s={data:function(){return{loginOK:!0,needLogin:!0,username:"",password:"",openid:"",sign_token:"",href:"",op:"",dynamicTitle:uni.getStorageSync("dynamicTitle"),edu:0,site_user:null,appFrom:"",isApp:!1,isChecked:!0}},components:{},props:{},onLoad:function(e){var t=this;e.appFrom&&(this.setData({appFrom:e.appFrom,isApp:!0}),console.log(this.appFrom),uni.setStorageSync("appFrom",this.appFrom),uni.setStorageSync("isApp",this.isApp));var n=a.tool.query("returnTo");void 0!=n&&uni.setStorageSync("returnTo",n),this.op="";var s=uni.getStorageSync("sso_token"),r=uni.getStorageSync("debug");if(1==r&&window.alert("will login in token:"+s),s){if(uni.removeStorageSync("account"),uni.removeStorageSync("cookie"),uni.removeStorageSync("info"),getApp().globalData.user.id=0,void 0==getApp().globalData.user.id||0==getApp().globalData.user.id)this.op=window.location.href,this.needLogin=!1,this.loginOK=!1,uni.setStorageSync("sso_token",s),o.api.auto_login_token({single_point_token:s},(function(e){if(500==e.code)return 1==r&&window.alert(e),t.needLogin=!0,t.loginOK=!0,void a.tool.info(e.message);200==e.code&&(getApp({allowDefault:!0}).globalData.user=e.data,uni.setStorageSync("info",e.data),o.api.menu_list({},(function(e){uni.setStorageSync("menuname",e.data),uni.setStorageSync("scrollTop",0);var t=uni.getStorageSync("returnTo");window.location.href=t})))}),(function(e){uni.removeStorageSync("sso_token"),console.log("自动登录失败")}));else if(Number(getApp().globalData.user.id)>0){var c=uni.getStorageSync("returnTo");console.log(c,"url"),c.indexOf("#/")>0?(this.setData({openid:"",needLogin:!1,loginOK:!1}),window.location.href=c,uni.removeStorageSync("returnTo")):"1"==this.edu&&"1"!=uni.getStorageSync("info").is_admin?i.wxapi.openUrl("/secure/training/center"):this.appFrom?i.wxapi.openUrl("/pages/home/home?type="+this.appFrom,2):i.wxapi.openUrl("/pages/home/home",2)}}else{this.needLogin=!0,this.loginOK=!0;var u=uni.getStorageSync("account");null!=u&&void 0!=u&&(this.setData({username:u.acc,password:u.pass}),this.username=u.acc);var p=uni.getStorageSync("autologin"),l=uni.getStorageSync("wechatlogin");console.log(Number(l),"wechat="),1==Number(p)||1==Number(l)?(this.setData({loginOK:!1,needLogin:!1}),this.autoLogin()):console.log(u,"accinfo")}},mounted:function(){var e=this;!this.isApp&&uni.getStorageSync("isApp")&&(this.isApp=!0,this.setData({isApp:!0})),!this.appFrom&&uni.getStorageSync("appFrom")&&(this.appFrom=uni.getStorageSync("appFrom"),this.setData({appFrom:uni.getStorageSync("appFrom")})),o.api.get_eid_user_list({},(function(t){console.log("res-----------",t),e.edu=t.data.data.config?t.data.data.config.edu:0,e.eid=t.data.eid,uni.setStorageSync("servername",t.data.servername),e.site_user=t.data.data.site_user}))},methods:{gotoAgreement:function(){if("zyxk"===this.appFrom)window.location.href="https://zay.saveus.cn/user_guide.html";else if("control"===this.appFrom)window.location.href="https://zay.saveus.cn/user_guide_sktx.html";else{var e="https://zay.saveus.cn/user_guide_"+this.appFrom+".html";window.location.href=e}},checkChange:function(){this.isChecked=!this.isChecked,console.log(this.isChecked)},inputUsername:function(e){this.setData({username:e.detail.value})},inputPassword:function(e){this.setData({password:e.detail.value})},autoLogin:function(){var e=this;uni.removeStorageSync("menuname");var t=getApp({allowDefault:!0}).globalData.user,n="";if(this.sign_token.length>0?n=this.sign_token:void 0!==t&&void 0!=t.login_token&&t.login_token.length>0&&(n=t.login_token),n.length>0)console.log("dengl"),o.api.auto_login_token({single_point_token:n},(function(t){console.log("00000"),uni.hideLoading(),200==t.code?e.getMenu(t):e.setData({openid:"",needLogin:!0,loginOK:!0})}));else{var s=uni.getStorageSync("wechatlogin");1==Number(s)?uni.login({success:function(t){t.code&&o.api.auto_login({code:t.code},(function(t){if(uni.hideLoading(),200==t.code)getApp({allowDefault:!0}).globalData.user=t.data,uni.setStorageSync("info",t.data),"1"==e.edu&&"1"!=uni.getStorageSync("info").is_admin&&(e.appFrom?i.wxapi.openUrl("/pages/home/home?type="+e.appFrom,2):i.wxapi.openUrl("/pages/home/home",2)),uni.setStorageSync("scrollTop",0);else{var n=uni.getStorageSync("dynamicTitle");a.tool.info("首次登录需要绑定您在"+n+"上的账号和密码"),e.setData({openid:t.data.data,needLogin:!0,loginOK:!0})}}))}}):this.setData({openid:"",needLogin:!0,loginOK:!0})}},registerClick:function(){console.log("进入注册页面"),this.appFrom?i.wxapi.openUrl("/pages/home/register?type="+this.appFrom,2):i.wxapi.openUrl("/pages/home/register",2)},submit:function(){var e=this;if(!this.isApp||this.isChecked){uni.removeStorageSync("menuname");var t=uni.getStorageSync("infocid"),n={account:this.username==this.site_user?this.username:+this.eid+this.username,password:this.password,openid:this.openid,cid:t};uni.setStorageSync("account",{acc:this.username}),o.api.user_signin(n,(function(t){e.getMenu(t)}))}else a.tool.info("请先同意隐私协议")},getMenu:function(e){var t=this;o.api.menu_list({},(function(n){uni.setStorageSync("menuname",n.data),getApp({allowDefault:!0}).globalData.user=e.data,uni.setStorageSync("info",e.data),uni.setStorageSync("scrollTop",0),"1"==t.edu&&"1"!=uni.getStorageSync("info").is_admin?i.wxapi.openUrl("/secure/training/center"):t.appFrom?i.wxapi.openUrl("/pages/home/home?type="+t.appFrom,2):i.wxapi.openUrl("/pages/home/home",2),t.op?i.wxapi.openUrl(t.op):"1"==t.edu&&"1"!=uni.getStorageSync("info").is_admin&&(t.appFrom?i.wxapi.openUrl("/pages/home/home?type="+t.appFrom,2):i.wxapi.openUrl("/pages/home/home",2))}))}}};t.default=s}}]);